<!DOCTYPE HTML>
<html>

<head>
	<title>Estoque</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
	<style>
	</style>
</head>

<body class="is-preload">
	<div id="wrapper">
		<div id="main">
			<div class="inner">
				<!-- Header -->
				<header id="header">
					<a href="{{ url_for('index') }}" class="logo"><strong>Estoque</strong> de materiais</a>
				</header>
				<!-- Content -->
				<section>
					<header class="main">
						<h1>Estoque</h1>
					</header>
					<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom:1em;">
						<a href="/estoque/novo" id="add-item-btn" class="button primary">Adicionar Item</a>
						<div style="display: flex; gap: 8px; margin-left: auto;">
							<button id="lock-toggle" class="button small btn-icon" title="Bloquear/Editar">
								<span id="lock-icon"><i class="fas fa-lock"></i></span>
								<span id="edit-icon" style="display:none;"><i class="fas fa-pencil-alt"></i></span>
							</button>
							<a href="{{ url_for('drag_drop.drag_drop') }}" class="button small btn-icon"
								title="Reordenar Estoque">
								<span><i class="fas fa-arrows-alt"></i></span>
							</a>
							
						</div>
					</div>
					<div class="table-wrapper">
						<table>
							<thead>
								<tr>
									<th>Nome</th>
									<th>Quantidade</th>
									<th>Observações</th>
									<th>Opções</th>
								</tr>
							</thead>
							<tbody>
								{% for item in inventory_items %}
								<tr data-id="{{ item.id }}">
									<td>{{ item.nome }}</td>
									<td>
										<span class="qtd-display">{{ item.quantidade }}</span>
										<span class="qtd-controls" style="display:none; margin-left:0.75em;">
											<button class="btn-up btn-icon" data-id="{{ item.id }}"
												data-delta="1">↑</button>
											<button class="btn-down btn-icon" data-id="{{ item.id }}"
												data-delta="-1">↓</button>
										</span>
									</td>
									<td>{{ item.observacoes }}</td>
									<td>
										<button class="button small options-btn">Opções</button>
										<span class="options-actions" style="display:none;">
											<button class="button small edit-btn">Editar</button>
											<button class="button small delete-btn">Excluir</button>
										</span>
										
									</td>
								</tr>
								{% else %}
								<tr>
									<td colspan="4">Nenhum item cadastrado.</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</section>
			</div>
		</div>
		<!-- Sidebar -->
		<div id="sidebar" class="inactive">
			<div class="toggle"></div>
			<div class="inner">
				<section id="search" class="alt">
					<form method="post" action="#">
						<input type="text" name="query" id="query" placeholder="Search" />
					</form>
				</section>
				<nav id="menu">
					<header class="major">
						<h2>Menu</h2>
					</header>
					<ul>
						<li><a href="{{ url_for('index') }}">Homepage</a></li>
						<li><a href="{{ url_for('client.client_list') }}">Clientes</a></li>
						<li><a href="{{ url_for('calendar.calendar_page') }}">Agenda Google</a></li>
						<li><a href="{{ url_for('estoque') }}">Estoque</a></li>
						<li><a href="{{ url_for('sessoes') }}">Sessões</a></li>
						<li><a href="{{ url_for('financeiro') }}">Financeiro</a></li>
						<li><a href="{{ url_for('registrar_pagamento') }}">Registrar Pagamento</a></li>
						<li><a href="{{ url_for('extrato') }}">Extrato</a></li>
						<li><a href="{{ url_for('cadastro_interno') }}">Cadastro Interno</a></li>
						<li><a href="{{ url_for('calculadora') }}">Calculadora</a></li>
						<li><a href="{{ url_for('historico') }}">Historico</a></li>
					</ul>
				</nav>
			</div>
		</div>
	</div>
	<script>
		// Independent toggles for locker and options
		function toggleOptions(btn) {
			var actions = btn.parentElement.querySelector('.options-actions');
			if (actions) {
				if (actions.style.display === 'none' || actions.style.display === '') {
					actions.style.display = 'inline-block';
				} else {
					actions.style.display = 'none';
				}
			}
		}

		window.INVENTORY_LOCKED = true;
		function toggleLockMode() {
			window.INVENTORY_LOCKED = !window.INVENTORY_LOCKED;
			document.getElementById('lock-icon').style.display = window.INVENTORY_LOCKED ? 'inline' : 'none';
			document.getElementById('edit-icon').style.display = window.INVENTORY_LOCKED ? 'none' : 'inline';
			updateLockerControls();
		}
		document.getElementById('lock-toggle').onclick = toggleLockMode;

		function updateLockerControls() {
			document.querySelectorAll('.qtd-controls').forEach(ctrl => {
				ctrl.style.display = window.INVENTORY_LOCKED ? 'none' : 'inline-block';
			});
			document.querySelectorAll('.btn-up, .btn-down').forEach(btn => {
				btn.disabled = window.INVENTORY_LOCKED;
			});
		}
		document.addEventListener('DOMContentLoaded', updateLockerControls);
	</script>
	<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/browser.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/breakpoints.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/util.js') }}"></script>
	<script src="{{ url_for('static', filename='js/main.js') }}"></script>
	<script src="{{ url_for('static', filename='js/inventory.js') }}"></script>
</body>

</html>