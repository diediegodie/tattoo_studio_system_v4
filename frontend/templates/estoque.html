{% set page_title = 'Estoque' %}
{% include 'partials/_head.html' %}

<body class="is-preload">
	<div id="wrapper">
		<div id="main">
			<div class="inner">
				<!-- Header -->
				<header id="header">
					<a href="#" class="logo"><strong>Estoque</strong> de materiais</a>
				</header>
				<!-- Content -->
				<section>
					<header class="main">
						<h1>Estoque</h1>
					</header>
					<div class="flex-between">
						<a href="/estoque/novo" id="add-item-btn" class="button primary">Adicionar Item</a>
						<div class="flex-gap-small">
							<button id="lock-toggle" class="button small btn-icon" title="Bloquear/Editar">
								<span id="lock-icon"><i class="fas fa-lock"></i></span>
								<span id="edit-icon" class="hidden"><i class="fas fa-pencil-alt"></i></span>
							</button>
							<a href="{{ url_for('drag_drop.drag_drop') }}" class="button small btn-icon"
								title="Reordenar Estoque">
								<span><i class="fas fa-arrows-alt"></i></span>
							</a>

						</div>
					</div>
					<div class="table-wrapper">
						<table>
							<thead>
								<tr>
									<th>Nome</th>
									<th>Quantidade</th>
									<th>Observações</th>
									<th>Opções</th>
								</tr>
							</thead>
							<tbody>
								{% for item in inventory_items %}
								<tr data-id="{{ item.id }}">
									<td>{{ item.nome }}</td>
									<td>
										<span class="qtd-display">{{ item.quantidade }}</span>
										<span class="qtd-controls hidden-with-margin">
											<button class="btn-up btn-icon" data-id="{{ item.id }}"
												data-delta="1">↑</button>
											<button class="btn-down btn-icon" data-id="{{ item.id }}"
												data-delta="-1">↓</button>
										</span>
									</td>
									<td>{{ item.observacoes }}</td>
									<td>
										<button class="button small options-btn"
											onclick="toggleOptions(this)">Opções</button>
										<span class="options-actions">
											<button class="button small edit-item-btn"
												data-id="{{ item.id }}">Editar</button>
											<button class="button small delete-item-btn"
												data-id="{{ item.id }}">Excluir</button>
										</span>

									</td>
								</tr>
								{% else %}
								<tr>
									<td colspan="4">Nenhum item cadastrado.</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</section>
			</div>
		</div>
		{% include 'partials/_sidebar.html' %}
	</div>
	{% include 'partials/_base_scripts.html' %}
	<script>
		// Inventory-specific functions
		window.INVENTORY_LOCKED = true;
		function toggleLockMode() {
			window.INVENTORY_LOCKED = !window.INVENTORY_LOCKED;
			document.getElementById('lock-icon').style.display = window.INVENTORY_LOCKED ? 'inline' : 'none';
			document.getElementById('edit-icon').style.display = window.INVENTORY_LOCKED ? 'none' : 'inline';
			updateLockerControls();
		}
		document.getElementById('lock-toggle').onclick = toggleLockMode;

		function updateLockerControls() {
			document.querySelectorAll('.qtd-controls').forEach(ctrl => {
				ctrl.style.display = window.INVENTORY_LOCKED ? 'none' : 'inline-block';
			});
			document.querySelectorAll('.btn-up, .btn-down').forEach(btn => {
				btn.disabled = window.INVENTORY_LOCKED;
			});
		}
		document.addEventListener('DOMContentLoaded', updateLockerControls);
	</script>
	<script src="{{ url_for('static', filename='js/inventory.js') }}"></script>
</body>

</html>