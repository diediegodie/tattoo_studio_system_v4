{% set page_title = 'Sessões' %}
{% include 'partials/_head.html' %}

<body class="is-preload">
	{% include 'partials/_flash_messages.html' %}
	<div id="wrapper">
		<div id="main">
			<div class="inner">
				<!-- Template selects for edit modal (hidden, reuse server-rendered options from nova_sessao) -->
				<div id="template-selects" class="hidden">
					<select id="tmpl_cliente_select">
						<option value="">Selecione...</option>
						{% for client in clients %}
						<option value="{{ client.id }}">{{ client.name }}</option>
						{% endfor %}
					</select>
					<select id="tmpl_artista_select">
						<option value="">Selecione...</option>
						{% for artist in artists %}
						<option value="{{ artist.id }}">{{ artist.name }}</option>
						{% endfor %}
					</select>
				</div>

				<!-- Header -->
				<header id="header">
					<a href="#" class="logo"><strong>Sessões</strong> agendadas</a>
				</header>

				<!-- Content -->
				<section>
					<header class="main">
						<h1>Sessões</h1>
					</header>

					<!-- Nova Sessão Button -->
					<a href="{{ url_for('sessoes.nova_sessao') }}" class="button primary new-session-btn">
						Nova sessão
					</a>

					<section>
						<div class="table-wrapper">
							<table>
								<thead>
									<tr>
										<th>Data</th>
										<th>Hora</th>
										<th>Cliente</th>
										<th>Artista</th>
										<th>Valor</th>
										<th>Observações</th>
										<th>Opções</th>
									</tr>
								</thead>
								<tbody>
									{% for sessao in sessoes %}
									<tr data-id="{{ sessao.id }}">
										<td>{{ sessao.data.strftime('%d/%m/%Y') if sessao.data else '' }}</td>
										<td>{{ sessao.hora.strftime('%H:%M') if sessao.hora else '' }}</td>
										<td>{{ sessao.cliente.name if sessao.cliente else 'Cliente não encontrado' }}
										</td>
										<td>{{ sessao.artista.name if sessao.artista else 'Artista não encontrado' }}
										</td>
										<td>R$ {{ '{:,.2f}'.format(sessao.valor) }}</td>
										<td>{{ sessao.observacoes }}</td>
										<td>
											<button class="button small options-btn"
												onclick="toggleOptions(this)">Opções</button>
											<span class="options-actions">
												<button class="button small finish-btn" data-id="{{ sessao.id }}"
													data-data="{{ sessao.data.strftime('%Y-%m-%d') if sessao.data else '' }}"
													data-cliente-id="{{ sessao.cliente.id if sessao.cliente else '' }}"
													data-artista-id="{{ sessao.artista.id if sessao.artista else '' }}"
													data-valor="{{ sessao.valor }}"
													data-observacoes="{{ sessao.observacoes or '' }}">Finalizar</button>
												<button class="button small edit-sessao-btn"
													data-id="{{ sessao.id }}">Editar</button>
												<button class="button small delete-sessao-btn"
													data-id="{{ sessao.id }}">Excluir</button>
											</span>
										</td>
									</tr>
									{% else %}
									<tr>
										<td colspan="7">Nenhuma sessão cadastrada.</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</section>

					<script>
						function toggleOptions(btn) {
							var actions = btn.parentElement.querySelector('.options-actions');
							if (actions) {
								actions.style.display = (actions.style.display === 'none' || actions.style.display === '') ? 'inline-block' : 'none';
							}
						}
					</script>

				</section>
			</div>
		</div>

		{% include 'partials/_sidebar.html' %}
	</div>

	<script src="{{ url_for('static', filename='js/common.js') }}"></script>
	{% include 'partials/_base_scripts.html' %}
	<script src="{{ url_for('static', filename='js/sessoes.js') }}"></script>

</body>

</html>