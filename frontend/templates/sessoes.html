<!DOCTYPE HTML>
<html>

<head>
	<title>Sessões</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
</head>

<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Main -->
		<div id="main">
			<div class="inner">

				<!-- Flash Messages -->
				{% with messages = get_flashed_messages(with_categories=true) %}
				{% if messages %}
				<div class="flash-messages">
					{% for category, message in messages %}
					<div class="flash-message {{ category }}">{{ message }}</div>
					{% endfor %}
				</div>
				{% endif %}
				{% endwith %}

				<!-- Template selects for edit modal (hidden, reuse server-rendered options from nova_sessao) -->
				<div id="template-selects" style="display:none;">
					<select id="tmpl_cliente_select">
						<option value="">Selecione...</option>
						{% for client in clients %}
						<option value="{{ client.id }}">{{ client.name }}</option>
						{% endfor %}
					</select>
					<select id="tmpl_artista_select">
						<option value="">Selecione...</option>
						{% for artist in artists %}
						<option value="{{ artist.id }}">{{ artist.name }}</option>
						{% endfor %}
					</select>
				</div>

				<!-- Header -->
				<header id="header">
					<a href="index.html" class="logo"><strong>Sessões</strong> de de clientes</a>
				</header>

				<!-- Content -->
				<section>
					<header class="main">
						<h1>Sessões</h1>
					</header>

					<!-- Nova Sessão Button -->
					<a href="{{ url_for('sessoes.nova_sessao') }}" class="button primary new-session-btn">
						Nova sessão
					</a>

					<section>
						<div class="table-wrapper">
							<table>
								<thead>
									<tr>
										<th>Data</th>
										<th>Hora</th>
										<th>Cliente</th>
										<th>Artista</th>
										<th>Valor</th>
										<th>Observações</th>
										<th>Opções</th>
									</tr>
								</thead>
								<tbody>
									{% for sessao in sessoes %}
									<tr data-id="{{ sessao.id }}">
										<td>{{ sessao.data.strftime('%d/%m/%Y') if sessao.data else '' }}</td>
										<td>{{ sessao.hora.strftime('%H:%M') if sessao.hora else '' }}</td>
										<td>{{ sessao.cliente.name if sessao.cliente else 'Cliente não encontrado' }}
										</td>
										<td>{{ sessao.artista.name if sessao.artista else 'Artista não encontrado' }}
										</td>
										<td>R$ {{ '{:,.2f}'.format(sessao.valor) }}</td>
										<td>{{ sessao.observacoes }}</td>
										<td>
											<button class="button small options-btn"
												onclick="toggleOptions(this)">Opções</button>
											<span class="options-actions" style="display:none;">
												<button class="button small finish-btn" data-id="{{ sessao.id }}"
													data-data="{{ sessao.data.strftime('%Y-%m-%d') if sessao.data else '' }}"
													data-cliente-id="{{ sessao.cliente.id if sessao.cliente else '' }}"
													data-artista-id="{{ sessao.artista.id if sessao.artista else '' }}"
													data-valor="{{ sessao.valor }}"
													data-observacoes="{{ sessao.observacoes or '' }}">Finalizar</button>
												<button class="button small edit-btn">Editar</button>
												<button class="button small delete-btn">Excluir</button>
											</span>
										</td>
									</tr>
									{% else %}
									<tr>
										<td colspan="7">Nenhuma sessão cadastrada.</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</section>

					<script>
						function toggleOptions(btn) {
							var actions = btn.parentElement.querySelector('.options-actions');
							if (actions) {
								actions.style.display = (actions.style.display === 'none' || actions.style.display === '') ? 'inline-block' : 'none';
							}
						}
					</script>

				</section>

			</div>
		</div>

		<!-- Sidebar -->
		<div id="sidebar" class="inactive">
			<div class="toggle"></div>
			<div class="inner">

				<!-- Search -->
				<section id="search" class="alt">
					<form method="post" action="#">
						<input type="text" name="query" id="query" placeholder="Search" />
					</form>
				</section>

				<!-- Menu -->
				<nav id="menu">
					<header class="major">
						<h2>Menu</h2>
					</header>
					<ul>
						<li><a href="{{ url_for('index') }}">Homepage</a></li>
						<li><a href="{{ url_for('client.client_list') }}">Clientes</a></li>
						<li><a href="{{ url_for('calendar.calendar_page') }}">Agenda Google</a></li>
						<li><a href="{{ url_for('estoque') }}">Estoque</a></li>
						<li><a href="{{ url_for('sessoes') }}">Sessões</a></li>
						<li><a href="{{ url_for('financeiro') }}">Financeiro</a></li>
						<li><a href="{{ url_for('registrar_pagamento') }}">Registrar Pagamento</a></li>
						<li><a href="{{ url_for('extrato') }}">Extrato</a></li>
						<li><a href="{{ url_for('cadastro_interno') }}">Cadastro Interno</a></li>
						<li><a href="{{ url_for('calculadora') }}">Calculadora</a></li>
						<li><a href="{{ url_for('historico') }}">Historico</a></li>
					</ul>
				</nav>
			</div>
		</div>
	</div>

	<!-- Scripts -->
	<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/browser.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/breakpoints.min.js') }}"></script>
	<script src="{{ url_for('static', filename='js/util.js') }}"></script>
	<script src="{{ url_for('static', filename='js/main.js') }}"></script>
	<script src="{{ url_for('static', filename='js/sessoes.js') }}"></script>

</body>

</html>