<!DOCTYPE HTML>
<html>

<head>
    <title>Financeiro</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
</head>

<body class="is-preload">

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Main -->
        <div id="main">
            <div class="inner">

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                    <div class="flash-message {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
                {% endif %}
                {% endwith %}

                <!-- Template selects for edit modal (hidden, reuse server-rendered options) -->
                <div id="template-selects" style="display:none;">
                    <select id="tmpl_cliente_select">
                        <option value="">Selecione...</option>
                        {% for client in clients %}
                        <option value="{{ client.id }}">{{ client.name }}</option>
                        {% endfor %}
                    </select>
                    <select id="tmpl_artista_select">
                        <option value="">Selecione...</option>
                        {% for artist in artists %}
                        <option value="{{ artist.id }}">{{ artist.name }}</option>
                        {% endfor %}
                    </select>
                    {% include 'partials/_forma_pagamento_select.html' %}
                </div>

                <!-- Header -->
                <header id="header">
                    <a href="#" class="logo"><strong>Gerenciamento</strong> de finanças</a>
                </header>

                <!-- Content -->
                <section>
                    <header class="main">
                        <h1>Financeiro</h1>
                    </header>
                    <div style="margin-bottom: 1em;">
                        <a href="{{ url_for('registrar_pagamento') }}" id="add-item-btn"
                            class="button primary">Registrar Pagamento</a>
                    </div>
                    <section>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Hora</th>
                                        <th>Cliente</th>
                                        <th>Artista</th>
                                        <th>Valor</th>
                                        <th>Forma de pagamento</th>
                                        <th>Observações</th>
                                        <th>Opções</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for pagamento in pagamentos %}
                                    <tr data-id="{{ pagamento.id }}">
                                        <td>{{ pagamento.data.strftime('%d/%m/%Y') if pagamento.data else '' }}</td>
                                        <td>{{ pagamento.hora.strftime('%H:%M') if pagamento.hora else '' }}</td>
                                        <td>{{ pagamento.cliente.name if pagamento.cliente else 'Cliente não encontrado'
                                            }}</td>
                                        <td>{{ pagamento.artista.name if pagamento.artista else 'Artista não encontrado'
                                            }}</td>
                                        <td>R$ {{ '{:,.2f}'.format(pagamento.valor) }}</td>
                                        <td>{{ pagamento.forma_pagamento }}</td>
                                        <td>{{ pagamento.observacoes }}</td>
                                        <td>
                                            <button class="button small options-btn"
                                                onclick="toggleOptions(this)">Opções</button>
                                            <span class="options-actions" style="display:none;">
                                                <button class="button small edit-pagamento-btn"
                                                    data-id="{{ pagamento.id }}">Editar</button>
                                                <button class="button small delete-pagamento-btn"
                                                    data-id="{{ pagamento.id }}">Excluir</button>
                                            </span>
                                        </td>
                                    </tr>
                                    {% else %}
                                    <tr>
                                        <td colspan="8">Nenhum pagamento registrado.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <script>
                        function toggleOptions(btn) {
                            var actions = btn.nextElementSibling;
                            if (actions.style.display === "none" || actions.style.display === "") {
                                actions.style.display = "inline-block";
                            } else {
                                actions.style.display = "none";
                            }
                        }
                    </script>

                </section>

            </div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar" class="inactive">
            <div class="toggle"></div>
            <div class="inner">

                <!-- Search -->
                <section id="search" class="alt">
                    <form method="get" action="{{ url_for('search.search_results_page') }}">
                        <input type="text" name="q" id="query" placeholder="Buscar cliente ou artista..." required />
                        <button type="submit" style="display: none;"></button>
                    </form>
                </section>

                <!-- Menu -->
                <nav id="menu">
                    <header class="major">
                        <h2>Menu</h2>
                    </header>
                    <ul>
                        <li><a href="{{ url_for('index') }}">Início</a></li>
						<li><a href="{{ url_for('estoque') }}">Estoque</a></li>
						<li><a href="{{ url_for('client.client_list') }}">Clientes</a></li>
						<li><a href="{{ url_for('calendar.calendar_page') }}">Google Agenda</a></li>
						<li><a href="{{ url_for('sessoes') }}">Próximas Sessões</a></li>
						<li><a href="{{ url_for('financeiro') }}">Pagamentos</a></li>
						<li><a href="{{ url_for('cadastro_interno') }}">Artistas</a></li>
						<li><a href="{{ url_for('calculadora') }}">Calculadora de Porcentagem</a></li>
						<li><a href="{{ url_for('historico') }}">Histórico</a></li>
						<li><a href="{{ url_for('extrato') }}">Extrato</a></li>
                    </ul>
                </nav>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/browser.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/breakpoints.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/util.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        window.FINANCEIRO_API_BASE = "{{ url_for('financeiro.api_list_pagamentos') }}";
    </script>
    <script src="{{ url_for('static', filename='js/financeiro.js') }}"></script>

</body>

</html>