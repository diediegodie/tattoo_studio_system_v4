# PostgreSQL Configuration for Tattoo Studio System
# This file enables pg_stat_statements for query performance monitoring

# Enable pg_stat_statements extension
shared_preload_libraries = 'pg_stat_statements'

# pg_stat_statements Configuration
pg_stat_statements.track = all              # Track all queries (top-level + nested)
pg_stat_statements.max = 10000              # Store up to 10,000 distinct queries
pg_stat_statements.track_utility = on       # Track utility statements (CREATE, DROP, etc.)
pg_stat_statements.save = on                # Persist stats across restarts

# Performance Tuning for Development
shared_buffers = 256MB                      # Shared memory for caching
effective_cache_size = 1GB                  # OS cache estimate
maintenance_work_mem = 64MB                 # Memory for VACUUM, CREATE INDEX
checkpoint_completion_target = 0.9          # Spread checkpoint writes

# Logging Configuration (queries over 100ms)
log_min_duration_statement = 100            # Log queries slower than 100ms
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = on
log_disconnections = on
log_duration = off                          # Don't log all durations (use log_min_duration_statement instead)
log_lock_waits = on                         # Log when queries wait for locks
log_statement = 'none'                      # Don't log all statements (use pg_stat_statements)
log_timezone = 'UTC'

# Connection Settings
max_connections = 100
